language: C

matrix:
  include:
    - os: linux
      compiler: gcc
      env: TEST_INTERVAL_LIB=gaol
    - os: linux
      compiler: gcc
      env: TEST_INTERVAL_LIB=filib
    - os: osx
      compiler: clang
      osx_image: xcode7.3
      env: TEST_INTERVAL_LIB=gaol
    # disable for now
    #- os: osx
    #  compiler: gcc
    #  env: TEST_INTERVAL_LIB=filib
  allow_failures: # temporary
    - os: osx


# only works on linux
addons:
  apt:
    packages:
      - python
      - flex
      - bison
      - libcppunit-dev

# need this to install dependencies on osx
before_install:
  - if [ "$TRAVIS_OS_NAME" = "osx" ] ; then brew update ; brew install python flex bison cppunit; fi

# TODO add --affine when tests are fixed
install: 
  - ./waf configure --prefix=$HOME --interval-lib=${TEST_INTERVAL_LIB} --with-optim --optim-lib=soplex || cat __build__/*.log
  - ./waf build install clean

# command to run tests
# TODO: add nonreg tests
script:  
  - ./waf utest
#  - __build__/examples/optimizer04 benchs/benchs-optim/coconutbenchmark-library1/ex8_5_2.bch acidhc4 compo smearsumrel 1.e-8 1.e-8 100 1

after_failure:
  - cat __build__/*.log
